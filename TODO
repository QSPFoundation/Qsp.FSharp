# Задания

## feat(cli): add `lint` subcommand

Если команда `search` должна искать код по образцу, то команда `lint` должна выявлять ошибки в коде.

По сути она работает точно так же, как и расширение, т.е. парсит код и попутно выявляет следующие ошибки:

* синтаксические ошибки (от чего сам парсер падает и не хочет парсить дальнейший код)
* вызов неизвестных процедур
* вызов неизвестных функций
* лишний `end`
* и т.д.

Программа должна писать всё это в консоль согласно следующему шаблону:

```
относительный/путь/к/игра.qsps(100, 10)
Лишний end:

код
```

Или что-то такое. Для вдохновения можно глянуть на ESLint или ещё куда.

Разрабатывать команду нужно по остаточному принципу: сперва сделать линт в `Core`, потом добавить ее в `ServerLanguage`, а уже затем добавлять в `Cli`.

Я так хочу, потому что расширение удобнее как по мне и нагляднее. Линт все равно нужно как-то отлаживать, а лучшей отладки чем через VS Code не придумаешь. С другой стороны, приоритет идёт на миграцию игр на новую версию Куспа, и желательно весь каталог Куспа так перебрать. Поэтому команде быть.

## Прочие

* Спросить у Байта насчёт `obj add 'Зелье'`: оно выглядит как statement, но но при этом не подчиняется синтаксису: `proc arg1, arg2, ...`

Синтаксис:
    ☐ Вызов процедуры `The(Lady), 'or', the, Tiger`. Сейчас такое `*p(Lady), 'or', the, Tiger` работает
    ☐ Сделать полноценный HTML-parser
    ☐ Если конструкция `if`/`act` обрывается на завершении локации, то можно так и сказать, а не расписывать полотно с ожидаемыми инструкциями
    ☐ Парсить лишние `)`, но помечать их как ошибки
    ☐ Как-то нужно определять, что конструкция `for` разрешена или нет
    ☐ `gs 'loc', , 1` — пропуск аргумента. В QSP 5.7.0 под Windows не работает, но работает в Quest Navigator, кажется.

Статический анализ:
    ☐ Удаление предмета, который нигде не добавляется
    ☐ Переменная присваивается, но ни разу не используется (заданные переменные — исключение)
    ☐ Переменная используется, но ни разу не присваивается (заданные переменные — исключение)
    ☐ Инструкции после `exit`, `jump` и прочих операторов перехода не сработают
    ☐ `a = 'foo'`, `#a = 'foo'`, `a[expr] = 'foo'`, `#a[expr] = 'foo'`

Highlight:
    ☐ Label highlight in `func('label')` or `$func('label')`

Форматирование:
    ☐ `stmt & ! comment`
